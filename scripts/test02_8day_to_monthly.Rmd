```{r}
library(magrittr)
library(terra)
```

```{r}
# WS
r <- rast('F:/ET/PML_V2/PML_V2_V018_ET_050deg_8day_2020.nc')
# PC
r <- rast('D:/Data/PML_V2_V018_ET_050deg_8day_China_2020-2021.nc')

r <- r %>% t() %>% flip(direction = 'vertical')
```

# test `aggregate_8day_to_yearly`

```{r}
system.time({
  r_yearly <- day8_to_yearly(r, cores = 30)
})

system.time({
  r_yearly <- day8_to_yearly(r)
})

r_yearly
```

# test `aggregate_8day_to_monthly`

```{r}
system.time({
  r_monthly <- aggregate_8day_to_monthly(r, agg_fun = sum, cores = 10)
})
gc()
r_yearly <- tapp(r_monthly, index = 'years', fun = 'sum', na.rm=T, cores = 10)
```